<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4-Relay Control Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; text-align:center; background:#f4f4f9; color:#333; }
  h2 { margin-top: 20px; }
  .relay-container { margin: 20px; }
  button { width: 100px; height: 50px; font-size:18px; margin:5px; border:none; border-radius:10px; cursor:pointer; color:white; }
  button:active { transform:translateY(2px); }
  .on { background: limegreen; }
  .off { background: tomato; }
  .disabled { background: gray; cursor: not-allowed; }
  #mqttStatus { font-weight:bold; font-size:18px; margin-top:20px; }
</style>
</head>
<body>

<h2>4-Relay Control Dashboard</h2>

<div class="relay-container">
  <p>Relay 1 Status: <b id="relay1Status">--</b></p>
  <button id="relay1On" onclick="sendCommand(1,'ON')">ON</button>
  <button id="relay1Off" onclick="sendCommand(1,'OFF')">OFF</button>
</div>

<div class="relay-container">
  <p>Relay 2 Status: <b id="relay2Status">--</b></p>
  <button id="relay2On" onclick="sendCommand(2,'ON')">ON</button>
  <button id="relay2Off" onclick="sendCommand(2,'OFF')">OFF</button>
</div>

<div class="relay-container">
  <p>Relay 3 Status: <b id="relay3Status">--</b></p>
  <button id="relay3On" onclick="sendCommand(3,'ON')">ON</button>
  <button id="relay3Off" onclick="sendCommand(3,'OFF')">OFF</button>
</div>

<div class="relay-container">
  <p>Relay 4 Status: <b id="relay4Status">--</b></p>
  <button id="relay4On" onclick="sendCommand(4,'ON')">ON</button>
  <button id="relay4Off" onclick="sendCommand(4,'OFF')">OFF</button>
</div>

<p id="mqttStatus">MQTT: Disconnected</p>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
// ------------------------ MQTT SETUP ------------------------
const broker = 'wss://93bad3def29641e399de9a7b9c676613.s1.eu.hivemq.cloud:8884/mqtt';
const options = {
  username: 'tohits',
  password: 'toh123@TOH',
  reconnectPeriod: 1000,
  clean: true,
  connectTimeout: 4000,
};
const client = mqtt.connect(broker, options);

// ------------------------ RELAY STATUS ------------------------
let relayStatus = [null,"OFF","OFF","OFF","OFF"];

// ------------------------ UPDATE UI ------------------------
function updateUI(ch){
  const statusEl = document.getElementById(`relay${ch}Status`);
  const onBtn = document.getElementById(`relay${ch}On`);
  const offBtn = document.getElementById(`relay${ch}Off`);
  
  statusEl.innerText = relayStatus[ch];

  if(relayStatus[ch]==="ON"){
    onBtn.className="on";
    offBtn.className="off";
  } else if(relayStatus[ch]==="OFF"){
    onBtn.className="off";
    offBtn.className="on";
  } else {
    onBtn.className="disabled";
    offBtn.className="disabled";
  }
}

// ------------------------ SEND COMMAND ------------------------
function sendCommand(ch, cmd){
  if(client.connected){
    client.publish(`relay${ch}/control`, cmd);
  } else {
    alert("MQTT is not connected!");
  }
}

// ------------------------ MQTT EVENTS ------------------------
client.on("connect", () => {
  const mqttStatusEl = document.getElementById("mqttStatus");
  mqttStatusEl.innerText = "MQTT: Connected";
  mqttStatusEl.style.color = "limegreen";

  for(let i=1;i<=4;i++){
    client.subscribe(`relay${i}/status`);
  }
});

client.on("reconnect", () => {
  const mqttStatusEl = document.getElementById("mqttStatus");
  mqttStatusEl.innerText = "MQTT: Reconnecting...";
  mqttStatusEl.style.color = "orange";
});

client.on("offline", () => {
  const mqttStatusEl = document.getElementById("mqttStatus");
  mqttStatusEl.innerText = "MQTT: Offline";
  mqttStatusEl.style.color = "red";
});

client.on("error", () => {
  const mqttStatusEl = document.getElementById("mqttStatus");
  mqttStatusEl.innerText = "MQTT: Error";
  mqttStatusEl.style.color = "red";
});

client.on("message", (topic, message) => {
  const msg = message.toString();
  for(let i=1;i<=4;i++){
    if(topic===`relay${i}/status`){
      relayStatus[i] = msg;
      updateUI(i);
    }
  }
});
</script>

</body>
</html>
